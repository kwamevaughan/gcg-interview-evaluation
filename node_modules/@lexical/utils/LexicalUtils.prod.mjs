/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 */

import{isHTMLElement as t,$getSelection as e,$isRangeSelection as n,$isElementNode as o,getDOMTextNode as r,$getRoot as i,$getChildCaret as l,$getSiblingCaret as u,$getAdjacentChildCaret as s,$getChildCaretOrSelf as c,makeStepwiseIterator as f,$isChildCaret as a,$cloneWithProperties as d,$setSelection as g,$getPreviousSelection as p,$isRootOrShadowRoot as m,$getChildCaretAtIndex as h,$isTextNode as v,$splitNode as y,$createParagraphNode as w,$isSiblingCaret as x,$rewindSiblingCaret as E}from"lexical";export{$splitNode,isBlockDomNode,isHTMLAnchorElement,isHTMLElement,isInlineDomNode}from"lexical";import{createRectsFromDOMRange as A}from"@lexical/selection";function S(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var C=S((function(t){const e=new URL("https://lexical.dev/docs/error"),n=new URLSearchParams;n.append("code",t);for(let t=1;t<arguments.length;t++)n.append("v",arguments[t]);throw e.search=n.toString(),Error(`Minified Lexical error #${t}; visit ${e.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}));const P="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement,L=P&&"documentMode"in document?document.documentMode:null,N=P&&/Mac|iPod|iPhone|iPad/.test(navigator.platform),b=P&&/^(?!.*Seamonkey)(?=.*Firefox).*/i.test(navigator.userAgent),T=!(!P||!("InputEvent"in window)||L)&&"getTargetRanges"in new window.InputEvent("input"),R=P&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent),M=P&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,B=P&&/Android/.test(navigator.userAgent),_=P&&/^(?=.*Chrome).*/i.test(navigator.userAgent),O=P&&B&&_,K=P&&/AppleWebKit\/[\d.]+/.test(navigator.userAgent)&&!_;function H(...t){const e=[];for(const n of t)if(n&&"string"==typeof n)for(const[t]of n.matchAll(/\S+/g))e.push(t);return e}function j(...t){return()=>{for(let e=t.length-1;e>=0;e--)t[e]();t.length=0}}function k(t){return`${t}px`}const D={attributes:!0,characterData:!0,childList:!0,subtree:!0};function I(e,n,o){let r=null,i=null,l=null,u=[];const s=document.createElement("div");function c(){null===r&&C(182),null===i&&C(183);const{left:t,top:l}=i.getBoundingClientRect(),c=A(e,n);var f,a;s.isConnected||(a=s,(f=i).insertBefore(a,f.firstChild));let d=!1;for(let e=0;e<c.length;e++){const n=c[e],o=u[e]||document.createElement("div"),r=o.style;"absolute"!==r.position&&(r.position="absolute",d=!0);const i=k(n.left-t);r.left!==i&&(r.left=i,d=!0);const f=k(n.top-l);r.top!==f&&(o.style.top=f,d=!0);const a=k(n.width);r.width!==a&&(o.style.width=a,d=!0);const g=k(n.height);r.height!==g&&(o.style.height=g,d=!0),o.parentNode!==s&&(s.append(o),d=!0),u[e]=o}for(;u.length>c.length;)u.pop();d&&o(u)}function f(){i=null,r=null,null!==l&&l.disconnect(),l=null,s.remove();for(const t of u)t.remove();u=[]}s.style.position="relative";const a=e.registerRootListener((function n(){const o=e.getRootElement();if(null===o)return f();const u=o.parentElement;if(!t(u))return f();f(),r=o,i=u,l=new MutationObserver((t=>{const o=e.getRootElement(),l=o&&o.parentElement;if(o!==r||l!==i)return n();for(const e of t)if(!s.contains(e.target))return c()})),l.observe(u,D),c()}));return()=>{a(),f()}}function U(t,e,n){if("text"!==t.type&&o(e)){const o=e.getDOMSlot(n);return[o.element,o.getFirstChildOffset()+t.offset]}return[r(n)||n,t.offset]}function $(t,o){let r=null,i=null,l=null,u=null,s=null,c=null,f=()=>{};function a(a){a.read((()=>{const a=e();if(!n(a))return r=null,l=null,u=null,c=null,f(),void(f=()=>{});const{anchor:d,focus:g}=a,p=d.getNode(),m=p.getKey(),h=d.offset,v=g.getNode(),y=v.getKey(),w=g.offset,x=t.getElementByKey(m),E=t.getElementByKey(y),A=null===r||x!==i||h!==l||m!==r.getKey(),S=null===u||E!==s||w!==c||y!==u.getKey();if((A||S)&&null!==x&&null!==E){const e=function(t,e,n,o,r,i,l){const u=(t._window?t._window.document:document).createRange();return i.isBefore(n)?(u.setStart(...U(r,i,l)),u.setEnd(...U(e,n,o))):(u.setStart(...U(e,n,o)),u.setEnd(...U(r,i,l))),u}(t,d,p,x,g,v,E);f(),f=I(t,e,(t=>{if(void 0===o)for(const e of t){const t=e.style;"Highlight"!==t.background&&(t.background="Highlight"),"HighlightText"!==t.color&&(t.color="HighlightText"),t.marginTop!==k(-1.5)&&(t.marginTop=k(-1.5)),t.paddingTop!==k(4)&&(t.paddingTop=k(4)),t.paddingBottom!==k(0)&&(t.paddingBottom=k(0))}else o(t)}))}r=p,i=x,l=h,u=v,s=E,c=w}))}return a(t.getEditorState()),j(t.registerUpdateListener((({editorState:t})=>a(t))),(()=>{f()}))}function z(t){let e=null;const n=()=>{const n=getSelection(),o=n&&n.anchorNode,r=t.getRootElement();null!==o&&null!==r&&r.contains(o)?null!==e&&(e(),e=null):null===e&&(e=$(t))};return document.addEventListener("selectionchange",n),()=>{null!==e&&e(),document.removeEventListener("selectionchange",n)}}const F=T,W=P,V=B,q=O,G=N,J=K,Q=_,X=b,Y=M,Z=R;function tt(t,...e){const n=H(...e);n.length>0&&t.classList.add(...n)}function et(t,...e){const n=H(...e);n.length>0&&t.classList.remove(...n)}function nt(t,e){for(const n of e)if(t.type.startsWith(n))return!0;return!1}function ot(t,e){const n=t[Symbol.iterator]();return new Promise(((t,o)=>{const r=[],i=()=>{const{done:l,value:u}=n.next();if(l)return t(r);const s=new FileReader;s.addEventListener("error",o),s.addEventListener("load",(()=>{const t=s.result;"string"==typeof t&&r.push({file:u,result:t}),i()})),nt(u,e)?s.readAsDataURL(u):i()};i()}))}function rt(t,e){return Array.from(ut(t,e))}function it(t){return t?t.getAdjacentCaret():null}function lt(t,e){return Array.from(dt(t,e))}function ut(t,e){return st("next",t,e)}function st(t,e,n){const r=i(),d=e||r,g=o(d)?l(d,t):u(d,t),p=ft(d),m=s(n?c(u(n,t)):g.getParentCaret("root"));let h=p;return f({hasNext:t=>null!==t,initial:g,map:t=>({depth:h,node:t.origin}),step:t=>{if(t.isSameNodeCaret(m))return null;a(t)&&h++;const e=_t(t);return!e||e[0].isSameNodeCaret(m)?null:(h+=e[1],e[0])}})}function ct(t){const e=_t(u(t,"next"));return e&&[e[0].origin,e[1]]}function ft(t){let e=-1;for(let n=t;null!==n;n=n.getParent())e++;return e}function at(t){const e=_t(c(u(t,"previous")),"root");return e&&e[0].origin}function dt(t,e){return st("previous",t,e)}function gt(t,e){let n=t;for(;null!=n;){if(n instanceof e)return n;n=n.getParent()}return null}function pt(t){const e=mt(t,(t=>o(t)&&!t.isInline()));return o(e)||C(4,t.__key),e}const mt=(t,e)=>{let n=t;for(;n!==i()&&null!=n;){if(e(n))return n;n=n.getParent()}return null};function ht(t,e,n,o){const r=t=>t instanceof e;return t.registerNodeTransform(e,(t=>{const e=(t=>{const e=t.getChildren();for(let t=0;t<e.length;t++){const n=e[t];if(r(n))return null}let n=t,o=t;for(;null!==n;)if(o=n,n=n.getParent(),r(n))return{child:o,parent:n};return null})(t);if(null!==e){const{child:r,parent:i}=e;if(r.is(t)){o(i,t);const e=r.getNextSiblings(),l=e.length;if(i.insertAfter(r),0!==l){const t=n(i);r.insertAfter(t);for(let n=0;n<l;n++)t.append(e[n])}i.canBeEmpty()||0!==i.getChildrenSize()||i.remove()}}}))}function vt(t,e){const n=new Map,o=t._pendingEditorState;for(const[t,o]of e._nodeMap)n.set(t,d(o));o&&(o._nodeMap=n),t._dirtyType=2;const r=e._selection;g(null===r?null:r.clone())}function yt(t){const o=e()||p();if(n(o)){const{focus:e}=o,n=e.getNode(),r=e.offset;if(m(n))h(n,r,"next").insert(t),t.selectNext();else{let e,o;v(n)?(e=n.getParentOrThrow(),o=n.getIndexWithinParent(),r>0&&(o+=1,n.splitText(r))):(e=n,o=r);const[,i]=y(e,o);i.insertBefore(t),i.selectStart()}}else{if(null!=o){const e=o.getNodes();e[e.length-1].getTopLevelElementOrThrow().insertAfter(t)}else i().append(t);const e=w();t.insertAfter(e),e.select()}return t.getLatest()}function wt(t,e){const n=e();return t.replace(n),n.append(t),n}function xt(t,e){return null!==t&&Object.getPrototypeOf(t).constructor.name===e.name}function Et(t,e){const n=[];for(let o=0;o<t.length;o++){const r=e(t[o]);null!==r&&n.push(r)}return n}function At(t,e){l(t,"next").insert(e)}let St=!(X||!W)&&void 0;function Ct(t){let e=1;if(function(){if(void 0===St){const t=document.createElement("div");t.style.cssText="position: absolute; opacity: 0; width: 100px; left: -1000px;",document.body.appendChild(t);const e=t.getBoundingClientRect();t.style.setProperty("zoom","2"),St=t.getBoundingClientRect().width===e.width,document.body.removeChild(t)}return St}())for(;t;)e*=Number(window.getComputedStyle(t).getPropertyValue("zoom")),t=t.parentElement;return e}function Pt(t){return null!==t._parentEditor}function Lt(t,e){return Nt(t,e,null)}function Nt(t,e,n){let r=!1;for(const i of Rt(t))e(i)?null!==n&&n(i):(r=!0,o(i)&&Nt(i,e,n||(t=>i.insertAfter(t))),i.remove());return r}function bt(t,e){const n=[],r=Array.from(t).reverse();for(let t=r.pop();void 0!==t;t=r.pop())if(e(t))n.push(t);else if(o(t))for(const e of Rt(t))r.push(e);return n}function Tt(t){return Mt(l(t,"next"))}function Rt(t){return Mt(l(t,"previous"))}function Mt(t){return f({hasNext:x,initial:t.getAdjacentCaret(),map:t=>t.origin.getLatest(),step:t=>t.getAdjacentCaret()})}function Bt(t){E(u(t,"next")).splice(1,t.getChildren())}function _t(t,e="root"){let n=0,o=t,r=s(o);for(;null===r;){if(n--,r=o.getParentCaret(e),!r)return null;o=r,r=s(o)}return r&&[r,n]}export{bt as $descendantsMatching,rt as $dfs,ut as $dfsIterator,Et as $filter,mt as $findMatchingParent,Tt as $firstToLastIterator,it as $getAdjacentCaret,_t as $getAdjacentSiblingOrParentSiblingCaret,ft as $getDepth,pt as $getNearestBlockElementAncestorOrThrow,gt as $getNearestNodeOfType,at as $getNextRightPreorderNode,ct as $getNextSiblingOrParentSibling,At as $insertFirst,yt as $insertNodeToNearestRoot,Pt as $isEditorIsNestedEditor,Rt as $lastToFirstIterator,vt as $restoreEditorState,lt as $reverseDfs,dt as $reverseDfsIterator,Lt as $unwrapAndFilterDescendants,Bt as $unwrapNode,wt as $wrapNodeInElement,F as CAN_USE_BEFORE_INPUT,W as CAN_USE_DOM,V as IS_ANDROID,q as IS_ANDROID_CHROME,G as IS_APPLE,J as IS_APPLE_WEBKIT,Q as IS_CHROME,X as IS_FIREFOX,Y as IS_IOS,Z as IS_SAFARI,tt as addClassNamesToElement,Ct as calculateZoomLevel,nt as isMimeType,$ as markSelection,ot as mediaFileReader,j as mergeRegister,xt as objectKlassEquals,I as positionNodeOnRange,ht as registerNestedElementResolver,et as removeClassNamesFromElement,z as selectionAlwaysOnDisplay};
