/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 */

"use strict";var e=require("@lexical/utils"),t=require("lexical");require("prismjs"),require("prismjs/components/prism-clike"),require("prismjs/components/prism-javascript"),require("prismjs/components/prism-markup"),require("prismjs/components/prism-markdown"),require("prismjs/components/prism-c"),require("prismjs/components/prism-css"),require("prismjs/components/prism-objectivec"),require("prismjs/components/prism-sql"),require("prismjs/components/prism-powershell"),require("prismjs/components/prism-python"),require("prismjs/components/prism-rust"),require("prismjs/components/prism-swift"),require("prismjs/components/prism-typescript"),require("prismjs/components/prism-java"),require("prismjs/components/prism-cpp");"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function n(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var r=n((function(e){const t=new URL("https://lexical.dev/docs/error"),n=new URLSearchParams;n.append("code",e);for(let e=1;e<arguments.length;e++)n.append("v",arguments[e]);throw t.search=n.toString(),Error(`Minified Lexical error #${e}; visit ${t.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}));const o=globalThis.Prism||window.Prism,i=e=>{try{return!!e&&o.languages.hasOwnProperty(e)}catch(e){return!1}};function s(t,n){for(const r of t.childNodes){if(e.isHTMLElement(r)&&r.tagName===n)return!0;s(r,n)}return!1}const a="data-language",l="data-highlight-language";class u extends t.ElementNode{static getType(){return"code"}static clone(e){return new u(e.__language,e.__key)}constructor(e,t){super(t),this.__language=e||void 0,this.__isSyntaxHighlightSupported=i(e)}createDOM(t){const n=document.createElement("code");e.addClassNamesToElement(n,t.theme.code),n.setAttribute("spellcheck","false");const r=this.getLanguage();return r&&(n.setAttribute(a,r),this.getIsSyntaxHighlightSupported()&&n.setAttribute(l,r)),n}updateDOM(e,t,n){const r=this.__language,o=e.__language;return r?r!==o&&(t.setAttribute(a,r),this.__isSyntaxHighlightSupported&&t.setAttribute(l,r)):o&&(t.removeAttribute(a),e.__isSyntaxHighlightSupported&&t.removeAttribute(l)),!1}exportDOM(t){const n=document.createElement("pre");e.addClassNamesToElement(n,t._config.theme.code),n.setAttribute("spellcheck","false");const r=this.getLanguage();return r&&(n.setAttribute(a,r),this.getIsSyntaxHighlightSupported()&&n.setAttribute(l,r)),{element:n}}static importDOM(){return{code:e=>null!=e.textContent&&(/\r?\n/.test(e.textContent)||s(e,"BR"))?{conversion:d,priority:1}:null,div:()=>({conversion:p,priority:1}),pre:()=>({conversion:d,priority:0}),table:e=>T(e)?{conversion:f,priority:3}:null,td:e=>{const t=e,n=t.closest("table");return t.classList.contains("js-file-line")||n&&T(n)?{conversion:h,priority:3}:null},tr:e=>{const t=e.closest("table");return t&&T(t)?{conversion:h,priority:3}:null}}}static importJSON(e){return g().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setLanguage(e.language)}exportJSON(){return{...super.exportJSON(),language:this.getLanguage()}}insertNewAfter(e,n=!0){const r=this.getChildren(),o=r.length;if(o>=2&&"\n"===r[o-1].getTextContent()&&"\n"===r[o-2].getTextContent()&&e.isCollapsed()&&e.anchor.key===this.__key&&e.anchor.offset===o){r[o-1].remove(),r[o-2].remove();const e=t.$createParagraphNode();return this.insertAfter(e,n),e}const{anchor:i,focus:s}=e,a=(i.isBefore(s)?i:s).getNode();if(t.$isTextNode(a)){let e=$(a);const n=[];for(;;)if(t.$isTabNode(e))n.push(t.$createTabNode()),e=e.getNextSibling();else{if(!M(e))break;{let t=0;const r=e.getTextContent(),o=e.getTextContentSize();for(;t<o&&" "===r[t];)t++;if(0!==t&&n.push(y(" ".repeat(t))),t!==o)break;e=e.getNextSibling()}}const r=a.splitText(i.offset)[0],o=0===i.offset?0:1,s=r.getIndexWithinParent()+o,l=a.getParentOrThrow(),u=[t.$createLineBreakNode(),...n];l.splice(s,0,u);const g=n[n.length-1];g?g.select():0===i.offset?r.selectPrevious():r.getNextSibling().selectNext(0,0)}if(c(a)){const{offset:n}=e.anchor;a.splice(n,0,[t.$createLineBreakNode()]),a.select(n+1,n+1)}return null}canIndent(){return!1}collapseAtStart(){const e=t.$createParagraphNode();return this.getChildren().forEach((t=>e.append(t))),this.replace(e),!0}setLanguage(e){const t=this.getWritable();return t.__language=e||void 0,t.__isSyntaxHighlightSupported=i(e),t}getLanguage(){return this.getLatest().__language}getIsSyntaxHighlightSupported(){return this.getLatest().__isSyntaxHighlightSupported}}function g(e){return t.$applyNodeReplacement(new u(e))}function c(e){return e instanceof u}function d(e){return{node:g(e.getAttribute(a))}}function p(e){const t=e,n=N(t);return n||function(e){let t=e.parentElement;for(;null!==t;){if(N(t))return!0;t=t.parentElement}return!1}(t)?{node:n?g():null}:{node:null}}function f(){return{node:g()}}function h(){return{node:null}}function N(e){return null!==e.style.fontFamily.match("monospace")}function T(e){return e.classList.contains("js-file-line-container")}const m="javascript",_={c:"C",clike:"C-like",cpp:"C++",css:"CSS",html:"HTML",java:"Java",js:"JavaScript",markdown:"Markdown",objc:"Objective-C",plain:"Plain Text",powershell:"PowerShell",py:"Python",rust:"Rust",sql:"SQL",swift:"Swift",typescript:"TypeScript",xml:"XML"},O={cpp:"cpp",java:"java",javascript:"js",md:"markdown",plaintext:"plain",python:"py",text:"plain",ts:"typescript"};function C(e){return O[e]||e}class x extends t.TextNode{constructor(e="",t,n){super(e,n),this.__highlightType=t}static getType(){return"code-highlight"}static clone(e){return new x(e.__text,e.__highlightType||void 0,e.__key)}getHighlightType(){return this.getLatest().__highlightType}setHighlightType(e){const t=this.getWritable();return t.__highlightType=e||void 0,t}canHaveFormat(){return!1}createDOM(t){const n=super.createDOM(t),r=S(t.theme,this.__highlightType);return e.addClassNamesToElement(n,r),n}updateDOM(t,n,r){const o=super.updateDOM(t,n,r),i=S(r.theme,t.__highlightType),s=S(r.theme,this.__highlightType);return i!==s&&(i&&e.removeClassNamesFromElement(n,i),s&&e.addClassNamesToElement(n,s)),o}static importJSON(e){return y().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setHighlightType(e.highlightType)}exportJSON(){return{...super.exportJSON(),highlightType:this.getHighlightType()}}setFormat(e){return this}isParentRequired(){return!0}createParentElementNode(){return g()}}function S(e,t){return t&&e&&e.codeHighlight&&e.codeHighlight[t]}function y(e="",n){return t.$applyNodeReplacement(new x(e,n))}function M(e){return e instanceof x}function $(e){let n=e,r=e;for(;M(r)||t.$isTabNode(r);)n=r,r=r.getPreviousSibling();return n}function b(e){let n=e,r=e;for(;M(r)||t.$isTabNode(r);)n=r,r=r.getNextSibling();return n}const A={defaultLanguage:m,tokenize(e,t){return o.tokenize(e,o.languages[t||""]||o.languages[this.defaultLanguage])}};function L(e,n){let o=null,i=null,s=e,a=n,l=e.getTextContent();for(;;){if(0===a){if(s=s.getPreviousSibling(),null===s)break;if(M(s)||t.$isTabNode(s)||t.$isLineBreakNode(s)||r(167),t.$isLineBreakNode(s)){o={node:s,offset:1};break}a=Math.max(0,s.getTextContentSize()-1),l=s.getTextContent()}else a--;const e=l[a];M(s)&&" "!==e&&(i={node:s,offset:a})}if(null!==i)return i;let u=null;if(n<e.getTextContentSize())M(e)&&(u=e.getTextContent()[n]);else{const t=e.getNextSibling();M(t)&&(u=t.getTextContent()[0])}if(null!==u&&" "!==u)return o;{const r=function(e,n){let r=e,o=n,i=e.getTextContent(),s=e.getTextContentSize();for(;;){if(!M(r)||o===s){if(r=r.getNextSibling(),null===r||t.$isLineBreakNode(r))return null;M(r)&&(o=0,i=r.getTextContent(),s=r.getTextContentSize())}if(M(r)){if(" "!==i[o])return{node:r,offset:o};o++}}}(e,n);return null!==r?r:o}}function E(e){const n=b(e);return t.$isLineBreakNode(n)&&r(168),n}function D(e,n,r){const o=e.getParent();c(o)?k(o,n,r):M(e)&&e.replace(t.$createTextNode(e.__text))}function v(e,n){const r=n.getElementByKey(e.getKey());if(null===r)return;const o=e.getChildren(),i=o.length;if(i===r.__cachedChildrenLength)return;r.__cachedChildrenLength=i;let s="1",a=1;for(let e=0;e<i;e++)t.$isLineBreakNode(o[e])&&(s+="\n"+ ++a);r.setAttribute("data-gutter",s)}const R=new Set;function k(e,n,r){const o=e.getKey();R.has(o)||(R.add(o),void 0===e.getLanguage()&&e.setLanguage(r.defaultLanguage),n.update((()=>{!function(e,n){const r=t.$getNodeByKey(e);if(!c(r)||!r.isAttached())return;const o=t.$getSelection();if(!t.$isRangeSelection(o))return void n();const i=o.anchor,s=i.offset,a="element"===i.type&&t.$isLineBreakNode(r.getChildAtIndex(i.offset-1));let l=0;if(!a){const e=i.getNode();l=s+e.getPreviousSiblings().reduce(((e,t)=>e+t.getTextContentSize()),0)}if(!n())return;if(a)return void i.getNode().select(s,s);r.getChildren().some((e=>{const n=t.$isTextNode(e);if(n||t.$isLineBreakNode(e)){const t=e.getTextContentSize();if(n&&t>=l)return e.select(l,l),!0;l-=t}return!1}))}(o,(()=>{const n=t.$getNodeByKey(o);if(!c(n)||!n.isAttached())return!1;const i=n.getTextContent(),s=P(r.tokenize(i,n.getLanguage()||r.defaultLanguage)),a=function(e,t){let n=0;for(;n<e.length&&B(e[n],t[n]);)n++;const r=e.length,o=t.length,i=Math.min(r,o)-n;let s=0;for(;s<i;)if(s++,!B(e[r-s],t[o-s])){s--;break}const a=n,l=r-s,u=t.slice(n,o-s);return{from:a,nodesForReplacement:u,to:l}}(n.getChildren(),s),{from:l,to:u,nodesForReplacement:g}=a;return!(l===u&&!g.length)&&(e.splice(l,u-l,g),!0)}))}),{onUpdate:()=>{R.delete(o)},skipTransforms:!0}))}function P(e,n){const r=[];for(const o of e)if("string"==typeof o){const e=o.split(/(\n|\t)/),i=e.length;for(let o=0;o<i;o++){const i=e[o];"\n"===i||"\r\n"===i?r.push(t.$createLineBreakNode()):"\t"===i?r.push(t.$createTabNode()):i.length>0&&r.push(y(i,n))}}else{const{content:e}=o;"string"==typeof e?r.push(...P([e],o.type)):Array.isArray(e)&&r.push(...P(e,o.type))}return r}function B(e,n){return M(e)&&M(n)&&e.__text===n.__text&&e.__highlightType===n.__highlightType||t.$isTabNode(e)&&t.$isTabNode(n)||t.$isLineBreakNode(e)&&t.$isLineBreakNode(n)}function w(e){if(!t.$isRangeSelection(e))return!1;const n=e.anchor.getNode(),r=e.focus.getNode();if(n.is(r)&&c(n))return!0;const o=n.getParent();return c(o)&&o.is(r.getParent())}function I(e){const n=e.getNodes(),o=[[]];if(1===n.length&&c(n[0]))return o;let i=o[0];for(let e=0;e<n.length;e++){const s=n[e];M(s)||t.$isTabNode(s)||t.$isLineBreakNode(s)||r(169),t.$isLineBreakNode(s)?0!==e&&i.length>0&&(i=[],o.push(i)):i.push(s)}return o}function j(e){const n=t.$getSelection();if(!t.$isRangeSelection(n)||!w(n))return!1;const o=I(n),i=o.length;if(o.length>1){for(let n=0;n<i;n++){const r=o[n];if(r.length>0){let o=r[0];0===n&&(o=$(o)),null!==o&&(e===t.INDENT_CONTENT_COMMAND?o.insertBefore(t.$createTabNode()):t.$isTabNode(o)&&o.remove())}}return!0}const s=n.getNodes()[0];if(c(s)||M(s)||t.$isTabNode(s)||t.$isLineBreakNode(s)||r(171),c(s))return e===t.INDENT_CONTENT_COMMAND&&n.insertNodes([t.$createTabNode()]),!0;const a=$(s);return null===a&&r(172),e===t.INDENT_CONTENT_COMMAND?t.$isLineBreakNode(a)?a.insertAfter(t.$createTabNode()):a.insertBefore(t.$createTabNode()):t.$isTabNode(a)&&a.remove(),!0}function H(e,n){const r=t.$getSelection();if(!t.$isRangeSelection(r))return!1;const{anchor:o,focus:i}=r,s=o.offset,a=i.offset,l=o.getNode(),u=i.getNode(),g=e===t.KEY_ARROW_UP_COMMAND;if(!w(r)||!M(l)&&!t.$isTabNode(l)||!M(u)&&!t.$isTabNode(u))return!1;if(!n.altKey){if(r.isCollapsed()){const e=l.getParentOrThrow();if(g&&0===s&&null===l.getPreviousSibling()){if(null===e.getPreviousSibling())return e.selectPrevious(),n.preventDefault(),!0}else if(!g&&s===l.getTextContentSize()&&null===l.getNextSibling()){if(null===e.getNextSibling())return e.selectNext(),n.preventDefault(),!0}}return!1}let c,d;if(l.isBefore(u)?(c=$(l),d=b(u)):(c=$(u),d=b(l)),null==c||null==d)return!1;const p=c.getNodesBetween(d);for(let e=0;e<p.length;e++){const n=p[e];if(!M(n)&&!t.$isTabNode(n)&&!t.$isLineBreakNode(n))return!1}n.preventDefault(),n.stopPropagation();const f=g?c.getPreviousSibling():d.getNextSibling();if(!t.$isLineBreakNode(f))return!0;const h=g?f.getPreviousSibling():f.getNextSibling();if(null==h)return!0;const N=M(h)||t.$isTabNode(h)||t.$isLineBreakNode(h)?g?$(h):b(h):null;let T=null!=N?N:h;return f.remove(),p.forEach((e=>e.remove())),e===t.KEY_ARROW_UP_COMMAND?(p.forEach((e=>T.insertBefore(e))),T.insertBefore(f)):(T.insertAfter(f),T=f,p.forEach((e=>{T.insertAfter(e),T=e}))),r.setTextNodeRange(l,s,u,a),!0}function q(e,n){const r=t.$getSelection();if(!t.$isRangeSelection(r))return!1;const{anchor:o,focus:i}=r,s=o.getNode(),a=i.getNode(),l=e===t.MOVE_TO_START;if(!w(r)||!M(s)&&!t.$isTabNode(s)||!M(a)&&!t.$isTabNode(a))return!1;if(l){const e=L(a,i.offset);if(null!==e){const{node:n,offset:o}=e;t.$isLineBreakNode(n)?n.selectNext(0,0):r.setTextNodeRange(n,o,n,o)}else a.getParentOrThrow().selectStart()}else{E(a).select()}return n.preventDefault(),n.stopPropagation(),!0}exports.$createCodeHighlightNode=y,exports.$createCodeNode=g,exports.$isCodeHighlightNode=M,exports.$isCodeNode=c,exports.CODE_LANGUAGE_FRIENDLY_NAME_MAP=_,exports.CODE_LANGUAGE_MAP=O,exports.CodeHighlightNode=x,exports.CodeNode=u,exports.DEFAULT_CODE_LANGUAGE=m,exports.PrismTokenizer=A,exports.getCodeLanguages=()=>Object.keys(o.languages).filter((e=>"function"!=typeof o.languages[e])).sort(),exports.getDefaultCodeLanguage=()=>m,exports.getEndOfCodeInLine=E,exports.getFirstCodeNodeOfLine=$,exports.getLanguageFriendlyName=function(e){const t=C(e);return _[t]||t},exports.getLastCodeNodeOfLine=b,exports.getStartOfCodeInLine=L,exports.normalizeCodeLang=C,exports.registerCodeHighlighting=function(n,o){if(!n.hasNodes([u,x]))throw new Error("CodeHighlightPlugin: CodeNode or CodeHighlightNode not registered on editor");return null==o&&(o=A),e.mergeRegister(n.registerMutationListener(u,(e=>{n.update((()=>{for(const[r,o]of e)if("destroyed"!==o){const e=t.$getNodeByKey(r);null!==e&&v(e,n)}}))}),{skipInitialization:!1}),n.registerNodeTransform(u,(e=>k(e,n,o))),n.registerNodeTransform(t.TextNode,(e=>D(e,n,o))),n.registerNodeTransform(x,(e=>D(e,n,o))),n.registerCommand(t.KEY_TAB_COMMAND,(e=>{const o=function(e){const n=t.$getSelection();if(!t.$isRangeSelection(n)||!w(n))return null;const o=e?t.OUTDENT_CONTENT_COMMAND:t.INDENT_CONTENT_COMMAND,i=e?t.OUTDENT_CONTENT_COMMAND:t.INSERT_TAB_COMMAND;if(I(n).length>1)return o;const s=n.getNodes()[0];if(c(s)||M(s)||t.$isTabNode(s)||t.$isLineBreakNode(s)||r(170),c(s))return o;const a=$(s),l=b(s),u=n.anchor,g=n.focus;let d,p;return g.isBefore(u)?(d=g,p=u):(d=u,p=g),null!==a&&null!==l&&d.key===a.getKey()&&0===d.offset&&p.key===l.getKey()&&p.offset===l.getTextContentSize()?o:i}(e.shiftKey);return null!==o&&(e.preventDefault(),n.dispatchCommand(o,void 0),!0)}),t.COMMAND_PRIORITY_LOW),n.registerCommand(t.INSERT_TAB_COMMAND,(()=>!!w(t.$getSelection())&&(t.$insertNodes([t.$createTabNode()]),!0)),t.COMMAND_PRIORITY_LOW),n.registerCommand(t.INDENT_CONTENT_COMMAND,(e=>j(t.INDENT_CONTENT_COMMAND)),t.COMMAND_PRIORITY_LOW),n.registerCommand(t.OUTDENT_CONTENT_COMMAND,(e=>j(t.OUTDENT_CONTENT_COMMAND)),t.COMMAND_PRIORITY_LOW),n.registerCommand(t.KEY_ARROW_UP_COMMAND,(e=>{const n=t.$getSelection();if(!t.$isRangeSelection(n))return!1;const{anchor:r}=n,o=r.getNode();return!!w(n)&&(n.isCollapsed()&&0===r.offset&&null===o.getPreviousSibling()&&c(o.getParentOrThrow())?(e.preventDefault(),!0):H(t.KEY_ARROW_UP_COMMAND,e))}),t.COMMAND_PRIORITY_LOW),n.registerCommand(t.KEY_ARROW_DOWN_COMMAND,(e=>{const n=t.$getSelection();if(!t.$isRangeSelection(n))return!1;const{anchor:r}=n,o=r.getNode();return!!w(n)&&(n.isCollapsed()&&r.offset===o.getTextContentSize()&&null===o.getNextSibling()&&c(o.getParentOrThrow())?(e.preventDefault(),!0):H(t.KEY_ARROW_DOWN_COMMAND,e))}),t.COMMAND_PRIORITY_LOW),n.registerCommand(t.MOVE_TO_START,(e=>q(t.MOVE_TO_START,e)),t.COMMAND_PRIORITY_LOW),n.registerCommand(t.MOVE_TO_END,(e=>q(t.MOVE_TO_END,e)),t.COMMAND_PRIORITY_LOW))};
