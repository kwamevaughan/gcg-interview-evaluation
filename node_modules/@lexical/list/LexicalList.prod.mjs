/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 */

import{$getNearestNodeOfType as e,removeClassNamesFromElement as t,addClassNamesToElement as n,isHTMLElement as r,mergeRegister as i}from"@lexical/utils";import{$getSelection as s,$isRangeSelection as o,$isRootOrShadowRoot as c,$createParagraphNode as l,$isElementNode as a,$isLeafNode as h,ElementNode as u,$isParagraphNode as g,$applyNodeReplacement as d,$createTextNode as f,createCommand as p,COMMAND_PRIORITY_LOW as _,INSERT_PARAGRAPH_COMMAND as m}from"lexical";function y(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var C=y((function(e){const t=new URL("https://lexical.dev/docs/error"),n=new URLSearchParams;n.append("code",e);for(let e=1;e<arguments.length;e++)n.append("v",arguments[e]);throw t.search=n.toString(),Error(`Minified Lexical error #${e}; visit ${t.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}));function v(e){let t=1,n=e.getParent();for(;null!=n;){if(K(n)){const e=n.getParent();if(H(e)){t++,n=e.getParent();continue}C(40)}return t}return t}function T(e){let t=e.getParent();H(t)||C(40);let n=t;for(;null!==n;)n=n.getParent(),H(n)&&(t=n);return t}function S(e){let t=[];const n=e.getChildren().filter(K);for(let e=0;e<n.length;e++){const r=n[e],i=r.getFirstChild();H(i)?t=t.concat(S(i)):t.push(r)}return t}function k(e){return K(e)&&H(e.getFirstChild())}function b(e){return B().append(e)}function N(e,t){return K(e)&&(0===t.length||1===t.length&&e.is(t[0])&&0===e.getChildrenSize())}function O(e){const t=s();if(null!==t){let n=t.getNodes();if(o(t)){const r=t.getStartEndPoints();null===r&&C(143);const[i]=r,s=i.getNode(),o=s.getParent();if(c(s)){const e=s.getFirstChild();if(e)n=e.selectStart().getNodes();else{const e=l();s.append(e),n=e.select().getNodes()}}else if(N(s,n)){const t=q(e);if(c(o)){s.replace(t);const e=B();a(s)&&(e.setFormat(s.getFormatType()),e.setIndent(s.getIndent())),t.append(e)}else if(K(s)){const e=s.getParentOrThrow();P(t,e.getChildren()),e.replace(t)}return}}const r=new Set;for(let t=0;t<n.length;t++){const i=n[t];if(!a(i)||!i.isEmpty()||K(i)||r.has(i.getKey())){if(h(i)){let t=i.getParent();for(;null!=t;){const n=t.getKey();if(H(t)){if(!r.has(n)){const i=q(e);P(i,t.getChildren()),t.replace(i),r.add(n)}break}{const i=t.getParent();if(c(i)&&!r.has(n)){r.add(n),A(t,e);break}t=i}}}}else A(i,e)}}}function P(e,t){e.splice(e.getChildrenSize(),0,t)}function A(e,t){if(H(e))return e;const n=e.getPreviousSibling(),r=e.getNextSibling(),i=B();let s;if(P(i,e.getChildren()),H(n)&&t===n.getListType())n.append(i),H(r)&&t===r.getListType()&&(P(n,r.getChildren()),r.remove()),s=n;else if(H(r)&&t===r.getListType())r.getFirstChildOrThrow().insertBefore(i),s=r;else{const n=q(t);n.append(i),e.replace(n),s=n}return i.setFormat(e.getFormatType()),i.setIndent(e.getIndent()),e.remove(),s}function x(e,t){const n=e.getLastChild(),r=t.getFirstChild();n&&r&&k(n)&&k(r)&&(x(n.getFirstChild(),r.getFirstChild()),r.remove());const i=t.getChildren();i.length>0&&e.append(...i),t.remove()}function L(){const t=s();if(o(t)){const n=new Set,r=t.getNodes(),i=t.anchor.getNode();if(N(i,r))n.add(T(i));else for(let t=0;t<r.length;t++){const i=r[t];if(h(i)){const t=e(i,I);null!=t&&n.add(T(t))}}for(const e of n){let n=e;const r=S(e);for(const e of r){const r=l();P(r,e.getChildren()),n.insertAfter(r),n=r,e.__key===t.anchor.key&&t.anchor.set(r.getKey(),0,"element"),e.__key===t.focus.key&&t.focus.set(r.getKey(),0,"element"),e.remove()}e.remove()}}}function F(e){const t=new Set;if(k(e)||t.has(e.getKey()))return;const n=e.getParent(),r=e.getNextSibling(),i=e.getPreviousSibling();if(k(r)&&k(i)){const n=i.getFirstChild();if(H(n)){n.append(e);const i=r.getFirstChild();if(H(i)){P(n,i.getChildren()),r.remove(),t.add(r.getKey())}}}else if(k(r)){const t=r.getFirstChild();if(H(t)){const n=t.getFirstChild();null!==n&&n.insertBefore(e)}}else if(k(i)){const t=i.getFirstChild();H(t)&&t.append(e)}else if(H(n)){const t=B(),s=q(n.getListType());t.append(s),s.append(e),i?i.insertAfter(t):r?r.insertBefore(t):n.append(t)}}function E(e){if(k(e))return;const t=e.getParent(),n=t?t.getParent():void 0;if(H(n?n.getParent():void 0)&&K(n)&&H(t)){const r=t?t.getFirstChild():void 0,i=t?t.getLastChild():void 0;if(e.is(r))n.insertBefore(e),t.isEmpty()&&n.remove();else if(e.is(i))n.insertAfter(e),t.isEmpty()&&n.remove();else{const r=t.getListType(),i=B(),s=q(r);i.append(s),e.getPreviousSiblings().forEach((e=>s.append(e)));const o=B(),c=q(r);o.append(c),P(c,e.getNextSiblings()),n.insertBefore(i),n.insertAfter(o),n.replace(e)}}}function M(){const e=s();if(!o(e)||!e.isCollapsed())return!1;const t=e.anchor.getNode();if(!K(t)||0!==t.getChildrenSize())return!1;const n=T(t),r=t.getParent();H(r)||C(40);const i=r.getParent();let a;if(c(i))a=l(),a.setTextStyle(e.style),a.setTextFormat(e.format),n.insertAfter(a);else{if(!K(i))return!1;a=B(),i.insertAfter(a)}a.select();const h=t.getNextSiblings();if(h.length>0){const e=q(r.getListType());if(K(a)){const t=B();t.append(e),a.insertAfter(t)}else a.insertAfter(e);e.append(...h)}return function(e){let t=e;for(;null==t.getNextSibling()&&null==t.getPreviousSibling();){const e=t.getParent();if(null==e||!K(t)&&!H(t))break;t=e}t.remove()}(t),!0}function w(...e){const t=[];for(const n of e)if(n&&"string"==typeof n)for(const[e]of n.matchAll(/\S+/g))t.push(e);return t}class I extends u{static getType(){return"listitem"}static clone(e){return new I(e.__value,e.__checked,e.__key)}constructor(e,t,n){super(n),this.__value=void 0===e?1:e,this.__checked=t}createDOM(e){const t=document.createElement("li"),n=this.getParent();return H(n)&&"check"===n.getListType()&&J(t,this,null),t.value=this.__value,D(t,e.theme,this),t}updateDOM(e,t,n){const r=this.getParent();return H(r)&&"check"===r.getListType()&&J(t,this,e),t.value=this.__value,D(t,n.theme,this),!1}static transform(){return e=>{if(K(e)||C(144),null==e.__checked)return;const t=e.getParent();H(t)&&"check"!==t.getListType()&&null!=e.getChecked()&&e.setChecked(void 0)}}static importDOM(){return{li:()=>({conversion:R,priority:0})}}static importJSON(e){return B().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setValue(e.value).setChecked(e.checked)}exportDOM(e){const t=this.createDOM(e._config);return t.style.textAlign=this.getFormatType(),{element:t}}exportJSON(){return{...super.exportJSON(),checked:this.getChecked(),value:this.getValue()}}append(...e){for(let t=0;t<e.length;t++){const n=e[t];if(a(n)&&this.canMergeWith(n)){const e=n.getChildren();this.append(...e),n.remove()}else super.append(n)}return this}replace(e,t){if(K(e))return super.replace(e);this.setIndent(0);const n=this.getParentOrThrow();if(!H(n))return e;if(n.__first===this.getKey())n.insertBefore(e);else if(n.__last===this.getKey())n.insertAfter(e);else{const t=q(n.getListType());let r=this.getNextSibling();for(;r;){const e=r;r=r.getNextSibling(),t.append(e)}n.insertAfter(e),e.insertAfter(t)}return t&&(a(e)||C(139),this.getChildren().forEach((t=>{e.append(t)}))),this.remove(),0===n.getChildrenSize()&&n.remove(),e}insertAfter(e,t=!0){const n=this.getParentOrThrow();if(H(n)||C(39),K(e))return super.insertAfter(e,t);const r=this.getNextSiblings();if(n.insertAfter(e,t),0!==r.length){const i=q(n.getListType());r.forEach((e=>i.append(e))),e.insertAfter(i,t)}return e}remove(e){const t=this.getPreviousSibling(),n=this.getNextSibling();super.remove(e),t&&n&&k(t)&&k(n)&&(x(t.getFirstChild(),n.getFirstChild()),n.remove())}insertNewAfter(e,t=!0){const n=B().updateFromJSON(this.exportJSON()).setChecked(!this.getChecked()&&void 0);return this.insertAfter(n,t),n}collapseAtStart(e){const t=l();this.getChildren().forEach((e=>t.append(e)));const n=this.getParentOrThrow(),r=n.getParentOrThrow(),i=K(r);if(1===n.getChildrenSize())if(i)n.remove(),r.select();else{n.insertBefore(t),n.remove();const r=e.anchor,i=e.focus,s=t.getKey();"element"===r.type&&r.getNode().is(this)&&r.set(s,r.offset,"element"),"element"===i.type&&i.getNode().is(this)&&i.set(s,i.offset,"element")}else n.insertBefore(t),this.remove();return!0}getValue(){return this.getLatest().__value}setValue(e){const t=this.getWritable();return t.__value=e,t}getChecked(){const e=this.getLatest();let t;const n=this.getParent();return H(n)&&(t=n.getListType()),"check"===t?Boolean(e.__checked):void 0}setChecked(e){const t=this.getWritable();return t.__checked=e,t}toggleChecked(){const e=this.getWritable();return e.setChecked(!e.__checked)}getIndent(){const e=this.getParent();if(null===e||!this.isAttached())return this.getLatest().__indent;let t=e.getParentOrThrow(),n=0;for(;K(t);)t=t.getParentOrThrow().getParentOrThrow(),n++;return n}setIndent(e){"number"!=typeof e&&C(117),(e=Math.floor(e))>=0||C(199);let t=this.getIndent();for(;t!==e;)t<e?(F(this),t++):(E(this),t--);return this}canInsertAfter(e){return K(e)}canReplaceWith(e){return K(e)}canMergeWith(e){return K(e)||g(e)}extractWithChild(e,t){if(!o(t))return!1;const n=t.anchor.getNode(),r=t.focus.getNode();return this.isParentOf(n)&&this.isParentOf(r)&&this.getTextContent().length===t.getTextContent().length}isParentRequired(){return!0}createParentElementNode(){return q("bullet")}canMergeWhenEmpty(){return!0}}function D(e,r,i){const s=[],o=[],c=r.list,l=c?c.listitem:void 0;let a;if(c&&c.nested&&(a=c.nested.listitem),void 0!==l&&s.push(...w(l)),c){const e=i.getParent(),t=H(e)&&"check"===e.getListType(),n=i.getChecked();t&&!n||o.push(c.listitemUnchecked),t&&n||o.push(c.listitemChecked),t&&s.push(n?c.listitemChecked:c.listitemUnchecked)}if(void 0!==a){const e=w(a);i.getChildren().some((e=>H(e)))?s.push(...e):o.push(...e)}o.length>0&&t(e,...o),s.length>0&&n(e,...s)}function J(e,t,n,r){H(t.getFirstChild())?(e.removeAttribute("role"),e.removeAttribute("tabIndex"),e.removeAttribute("aria-checked")):(e.setAttribute("role","checkbox"),e.setAttribute("tabIndex","-1"),n&&t.__checked===n.__checked||e.setAttribute("aria-checked",t.getChecked()?"true":"false"))}function R(e){if(e.classList.contains("task-list-item"))for(const t of e.children)if("INPUT"===t.tagName)return W(t);const t=e.getAttribute("aria-checked");return{node:B("true"===t||"false"!==t&&void 0)}}function W(e){if(!("checkbox"===e.getAttribute("type")))return{node:null};return{node:B(e.hasAttribute("checked"))}}function B(e){return d(new I(void 0,e))}function K(e){return e instanceof I}class V extends u{static getType(){return"list"}static clone(e){const t=e.__listType||j[e.__tag];return new V(t,e.__start,e.__key)}constructor(e="number",t=1,n){super(n);const r=j[e]||e;this.__listType=r,this.__tag="number"===r?"ol":"ul",this.__start=t}getTag(){return this.__tag}setListType(e){const t=this.getWritable();return t.__listType=e,t.__tag="number"===e?"ol":"ul",t}getListType(){return this.__listType}getStart(){return this.__start}setStart(e){const t=this.getWritable();return t.__start=e,t}createDOM(e,t){const n=this.__tag,r=document.createElement(n);return 1!==this.__start&&r.setAttribute("start",String(this.__start)),r.__lexicalListType=this.__listType,U(r,e.theme,this),r}updateDOM(e,t,n){return e.__tag!==this.__tag||(U(t,n.theme,this),!1)}static transform(){return e=>{H(e)||C(163),function(e){const t=e.getNextSibling();H(t)&&e.getListType()===t.getListType()&&x(e,t)}(e),function(e){const t="check"!==e.getListType();let n=e.getStart();for(const r of e.getChildren())K(r)&&(r.getValue()!==n&&r.setValue(n),t&&null!=r.getLatest().__checked&&r.setChecked(void 0),H(r.getFirstChild())||n++)}(e)}}static importDOM(){return{ol:()=>({conversion:$,priority:0}),ul:()=>({conversion:$,priority:0})}}static importJSON(e){return q().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setListType(e.listType).setStart(e.start)}exportDOM(e){const t=this.createDOM(e._config,e);return r(t)&&(1!==this.__start&&t.setAttribute("start",String(this.__start)),"check"===this.__listType&&t.setAttribute("__lexicalListType","check")),{element:t}}exportJSON(){return{...super.exportJSON(),listType:this.getListType(),start:this.getStart(),tag:this.getTag()}}canBeEmpty(){return!1}canIndent(){return!1}append(...e){for(let t=0;t<e.length;t++){const n=e[t];if(K(n))super.append(n);else{const e=B();if(H(n))e.append(n);else if(a(n))if(n.isInline())e.append(n);else{const t=f(n.getTextContent());e.append(t)}else e.append(n);super.append(e)}}return this}extractWithChild(e){return K(e)}}function U(e,r,i){const s=[],o=[],c=r.list;if(void 0!==c){const e=c[`${i.__tag}Depth`]||[],t=v(i)-1,n=t%e.length,r=e[n],l=c[i.__tag];let a;const h=c.nested,u=c.checklist;if(void 0!==h&&h.list&&(a=h.list),void 0!==l&&s.push(l),void 0!==u&&"check"===i.__listType&&s.push(u),void 0!==r){s.push(...w(r));for(let t=0;t<e.length;t++)t!==n&&o.push(i.__tag+t)}if(void 0!==a){const e=w(a);t>1?s.push(...e):o.push(...e)}}o.length>0&&t(e,...o),s.length>0&&n(e,...s)}function z(e){const t=[];for(let n=0;n<e.length;n++){const r=e[n];if(K(r)){t.push(r);const e=r.getChildren();e.length>1&&e.forEach((e=>{H(e)&&t.push(b(e))}))}else t.push(b(r))}return t}function $(e){const t=e.nodeName.toLowerCase();let n=null;if("ol"===t){n=q("number",e.start)}else"ul"===t&&(n=function(e){if("check"===e.getAttribute("__lexicallisttype")||e.classList.contains("contains-task-list"))return!0;for(const t of e.childNodes)if(r(t)&&t.hasAttribute("aria-checked"))return!0;return!1}(e)?q("check"):q("bullet"));return{after:z,node:n}}const j={ol:"number",ul:"bullet"};function q(e="number",t=1){return d(new V(e,t))}function H(e){return e instanceof V}const G=p("INSERT_UNORDERED_LIST_COMMAND"),Q=p("INSERT_ORDERED_LIST_COMMAND"),X=p("INSERT_CHECK_LIST_COMMAND"),Y=p("REMOVE_LIST_COMMAND");function Z(e){return i(e.registerCommand(Q,(()=>(O("number"),!0)),_),e.registerCommand(G,(()=>(O("bullet"),!0)),_),e.registerCommand(Y,(()=>(L(),!0)),_),e.registerCommand(m,(()=>!!M()),_))}function ee(e,t){e.update((()=>O(t)))}function te(e){e.update((()=>L()))}export{B as $createListItemNode,q as $createListNode,v as $getListDepth,M as $handleListInsertParagraph,O as $insertList,K as $isListItemNode,H as $isListNode,L as $removeList,X as INSERT_CHECK_LIST_COMMAND,Q as INSERT_ORDERED_LIST_COMMAND,G as INSERT_UNORDERED_LIST_COMMAND,I as ListItemNode,V as ListNode,Y as REMOVE_LIST_COMMAND,ee as insertList,Z as registerList,te as removeList};
